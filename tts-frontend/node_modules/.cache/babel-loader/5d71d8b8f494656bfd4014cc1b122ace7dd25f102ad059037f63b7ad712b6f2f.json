{"ast":null,"code":"import { mapState } from 'vuex';\nimport api from '@/services/api';\nexport default {\n  name: 'TTSGenerator',\n  data() {\n    return {\n      inputText: '',\n      selectedSpeaker: '',\n      audioUrl: '',\n      isGenerating: false,\n      error: ''\n    };\n  },\n  watch: {\n    speakers(newSpeakers) {\n      if (newSpeakers && newSpeakers.length > 0) {\n        this.selectedSpeaker = newSpeakers[0];\n      } else {\n        this.selectedSpeaker = '';\n      }\n    }\n  },\n  computed: {\n    ...mapState('tts', {\n      speakers: state => state.speakers,\n      isLoading: state => state.isLoading,\n      ttsError: state => state.error\n    })\n  },\n  mounted() {\n    // 加载说话人列表\n    this.$store.dispatch('tts/fetchSpeakers');\n  },\n  methods: {\n    async generateSpeech() {\n      if (!this.inputText.trim()) {\n        this.error = '请输入要转换的文字';\n        return;\n      }\n      this.error = '';\n      this.isGenerating = true;\n      try {\n        const response = await api.generateTTS({\n          text: this.inputText,\n          speaker: this.selectedSpeaker\n        });\n        console.log('完整响应数据:', response.data); // 调试用\n\n        // 修改这里：匹配后端实际返回的字段名\n        if (response.data && response.data.result === \"success\") {\n          // 如果后端返回了文件路径，使用它\n          if (response.data.file_path) {\n            this.audioUrl = `${process.env.VUE_APP_API_URL}/${response.data.file_path}`;\n          }\n          // 如果后端直接返回音频数据（base64或其他格式）\n          else if (response.data.audio_data) {\n            // 根据后端返回的音频数据处理\n            this.audioUrl = `data:audio/wav;base64,${response.data.audio_data}`;\n          }\n          // 如果后端没有返回音频数据，需要询问后端开发者正确的获取方式\n          else {\n            // 临时方案：尝试构造可能的音频URL\n            const timestamp = new Date().getTime();\n            this.audioUrl = `${process.env.VUE_APP_API_URL}/audio/generated_${timestamp}.wav`;\n\n            // 或者显示提示信息\n            console.warn('后端成功但未返回音频数据，请检查后端实现');\n          }\n        } else {\n          throw new Error(response.data?.message || '生成语音失败');\n        }\n      } catch (err) {\n        this.error = `生成语音失败: ${err.message}`;\n        console.error('生成语音失败详情:', err);\n      } finally {\n        this.isGenerating = false;\n      }\n    },\n    copyShareLink() {\n      if (!this.audioUrl) return;\n      navigator.clipboard.writeText(this.audioUrl).then(() => {\n        alert('分享链接已复制到剪贴板');\n      }).catch(err => {\n        console.error('复制链接失败:', err);\n        alert('复制链接失败，请手动复制');\n      });\n    }\n  }\n};","map":{"version":3,"names":["mapState","api","name","data","inputText","selectedSpeaker","audioUrl","isGenerating","error","watch","speakers","newSpeakers","length","computed","state","isLoading","ttsError","mounted","$store","dispatch","methods","generateSpeech","trim","response","generateTTS","text","speaker","console","log","result","file_path","process","env","VUE_APP_API_URL","audio_data","timestamp","Date","getTime","warn","Error","message","err","copyShareLink","navigator","clipboard","writeText","then","alert","catch"],"sources":["src/components/TTSGenerator.vue"],"sourcesContent":["<template>\n  <div class=\"tts-generator\">\n    <h2>文字转语音生成器</h2>\n\n    <!-- 加载状态提示 -->\n    <div v-if=\"isLoading\" class=\"loading-message\">\n      加载说话人列表中...\n    </div>\n\n    <div class=\"input-section\">\n      <textarea\n          v-model=\"inputText\"\n          placeholder=\"输入要转换的文字...\"\n          rows=\"5\"\n          class=\"text-input\"\n      ></textarea>\n\n      <div class=\"controls\">\n        <!-- 说话人选择器 -->\n        <div class=\"speaker-select\" v-if=\"speakers && speakers.length > 0\">\n          <label>说话人:</label>\n          <select v-model=\"selectedSpeaker\">\n            <option v-for=\"speaker in speakers\" :key=\"speaker\" :value=\"speaker\">\n              {{ speaker }}\n            </option>\n          </select>\n        </div>\n\n        <!-- 无说话人时的提示 -->\n        <div v-else-if=\"!isLoading\" class=\"no-speakers\">\n          无可用说话人\n        </div>\n\n        <!-- 生成按钮 -->\n        <button\n            @click=\"generateSpeech\"\n            :disabled=\"isGenerating || isLoading\"\n            class=\"generate-btn\"\n        >\n          <span v-if=\"isGenerating\">生成中...</span>\n          <span v-else>生成语音</span>\n        </button>\n      </div>\n    </div>\n\n    <!-- 音频播放区域 -->\n    <div class=\"audio-section\" v-if=\"audioUrl\">\n      <audio :src=\"audioUrl\" controls class=\"audio-player\"></audio>\n      <div class=\"audio-actions\">\n        <a :href=\"audioUrl\" download=\"generated_speech.wav\" class=\"download-btn\">\n          下载音频\n        </a>\n        <button @click=\"copyShareLink\" class=\"share-btn\">\n          复制分享链接\n        </button>\n      </div>\n    </div>\n\n    <!-- 错误信息显示 -->\n    <div v-if=\"error\" class=\"error-message\">\n      {{ error }}\n    </div>\n\n    <!-- Vuex 错误信息显示 -->\n    <div v-if=\"ttsError\" class=\"error-message\">\n      {{ ttsError }}\n    </div>\n  </div>\n</template>\n\n<script>\nimport { mapState } from 'vuex';\nimport api from '@/services/api';\n\nexport default {\n  name: 'TTSGenerator',\n  data() {\n    return {\n      inputText: '',\n      selectedSpeaker: '',\n      audioUrl: '',\n      isGenerating: false,\n      error: ''\n    };\n  },\n  watch: {\n    speakers(newSpeakers) {\n      if (newSpeakers && newSpeakers.length > 0) {\n        this.selectedSpeaker = newSpeakers[0];\n      } else {\n        this.selectedSpeaker = '';\n      }\n    }\n  },\n  computed: {\n    ...mapState('tts', {\n      speakers: state => state.speakers,\n      isLoading: state => state.isLoading,\n      ttsError: state => state.error\n    })\n  },\n  mounted() {\n    // 加载说话人列表\n    this.$store.dispatch('tts/fetchSpeakers');\n  },\n  methods: {\n    async generateSpeech() {\n      if (!this.inputText.trim()) {\n        this.error = '请输入要转换的文字';\n        return;\n      }\n\n      this.error = '';\n      this.isGenerating = true;\n\n      try {\n        const response = await api.generateTTS({\n          text: this.inputText,\n          speaker: this.selectedSpeaker\n        });\n\n        console.log('完整响应数据:', response.data); // 调试用\n\n        // 修改这里：匹配后端实际返回的字段名\n        if (response.data && response.data.result === \"success\") {\n          // 如果后端返回了文件路径，使用它\n          if (response.data.file_path) {\n            this.audioUrl = `${process.env.VUE_APP_API_URL}/${response.data.file_path}`;\n          }\n          // 如果后端直接返回音频数据（base64或其他格式）\n          else if (response.data.audio_data) {\n            // 根据后端返回的音频数据处理\n            this.audioUrl = `data:audio/wav;base64,${response.data.audio_data}`;\n          }\n          // 如果后端没有返回音频数据，需要询问后端开发者正确的获取方式\n          else {\n            // 临时方案：尝试构造可能的音频URL\n            const timestamp = new Date().getTime();\n            this.audioUrl = `${process.env.VUE_APP_API_URL}/audio/generated_${timestamp}.wav`;\n\n            // 或者显示提示信息\n            console.warn('后端成功但未返回音频数据，请检查后端实现');\n          }\n        } else {\n          throw new Error(response.data?.message || '生成语音失败');\n        }\n      } catch (err) {\n        this.error = `生成语音失败: ${err.message}`;\n        console.error('生成语音失败详情:', err);\n      } finally {\n        this.isGenerating = false;\n      }\n    },\n    copyShareLink() {\n      if (!this.audioUrl) return;\n\n      navigator.clipboard.writeText(this.audioUrl)\n          .then(() => {\n            alert('分享链接已复制到剪贴板');\n          })\n          .catch(err => {\n            console.error('复制链接失败:', err);\n            alert('复制链接失败，请手动复制');\n          });\n    },\n  },\n};\n</script>\n\n<style scoped>\n.tts-generator {\n  max-width: 800px;\n  margin: 0 auto;\n  padding: 30px;\n  background-color: #ffffff;\n  border-radius: 12px;\n  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);\n}\n\nh2 {\n  text-align: center;\n  color: #2c3e50;\n  margin-bottom: 25px;\n  font-size: 28px;\n}\n\n.input-section {\n  margin-bottom: 25px;\n}\n\n.text-input {\n  width: 100%;\n  padding: 15px;\n  border: 1px solid #e0e0e0;\n  border-radius: 8px;\n  font-size: 16px;\n  line-height: 1.5;\n  resize: vertical;\n  transition: border-color 0.3s;\n}\n\n.text-input:focus {\n  border-color: #3498db;\n  outline: none;\n  box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);\n}\n\n.controls {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-top: 15px;\n}\n\n.speaker-select {\n  display: flex;\n  align-items: center;\n}\n\n.speaker-select label {\n  margin-right: 10px;\n  color: #555;\n  font-weight: 500;\n}\n\n.speaker-select select {\n  padding: 10px 15px;\n  border: 1px solid #e0e0e0;\n  border-radius: 6px;\n  background-color: #f9f9f9;\n  font-size: 16px;\n}\n\n.no-speakers {\n  color: #777;\n  font-style: italic;\n}\n\n.generate-btn {\n  background-color: #3498db;\n  color: white;\n  border: none;\n  padding: 12px 25px;\n  border-radius: 6px;\n  font-size: 16px;\n  font-weight: 500;\n  cursor: pointer;\n  transition: background-color 0.3s;\n}\n\n.generate-btn:hover:not(:disabled) {\n  background-color: #2980b9;\n}\n\n.generate-btn:disabled {\n  background-color: #95a5a6;\n  cursor: not-allowed;\n}\n\n.audio-section {\n  margin-top: 25px;\n  padding: 20px;\n  background-color: #f8f9fa;\n  border-radius: 8px;\n  animation: fadeIn 0.5s ease;\n}\n\n@keyframes fadeIn {\n  from { opacity: 0; transform: translateY(10px); }\n  to { opacity: 1; transform: translateY(0); }\n}\n\n.audio-player {\n  width: 100%;\n  margin-bottom: 15px;\n}\n\n.audio-actions {\n  display: flex;\n  gap: 15px;\n}\n\n.download-btn, .share-btn {\n  flex: 1;\n  text-align: center;\n  padding: 12px;\n  border-radius: 6px;\n  font-weight: 500;\n  text-decoration: none;\n  transition: all 0.3s;\n}\n\n.download-btn {\n  background-color: #2ecc71;\n  color: white;\n}\n\n.download-btn:hover {\n  background-color: #27ae60;\n}\n\n.share-btn {\n  background-color: #9b59b6;\n  color: white;\n  border: none;\n  cursor: pointer;\n}\n\n.share-btn:hover {\n  background-color: #8e44ad;\n}\n\n.error-message {\n  margin-top: 20px;\n  padding: 15px;\n  background-color: #ffebee;\n  color: #c62828;\n  border-radius: 8px;\n  text-align: center;\n}\n\n.loading-message {\n  margin-top: 10px;\n  padding: 10px;\n  background-color: #e3f2fd;\n  color: #1976d2;\n  border-radius: 6px;\n  text-align: center;\n}\n</style>"],"mappings":"AAuEA,SAAAA,QAAA;AACA,OAAAC,GAAA;AAEA;EACAC,IAAA;EACAC,KAAA;IACA;MACAC,SAAA;MACAC,eAAA;MACAC,QAAA;MACAC,YAAA;MACAC,KAAA;IACA;EACA;EACAC,KAAA;IACAC,SAAAC,WAAA;MACA,IAAAA,WAAA,IAAAA,WAAA,CAAAC,MAAA;QACA,KAAAP,eAAA,GAAAM,WAAA;MACA;QACA,KAAAN,eAAA;MACA;IACA;EACA;EACAQ,QAAA;IACA,GAAAb,QAAA;MACAU,QAAA,EAAAI,KAAA,IAAAA,KAAA,CAAAJ,QAAA;MACAK,SAAA,EAAAD,KAAA,IAAAA,KAAA,CAAAC,SAAA;MACAC,QAAA,EAAAF,KAAA,IAAAA,KAAA,CAAAN;IACA;EACA;EACAS,QAAA;IACA;IACA,KAAAC,MAAA,CAAAC,QAAA;EACA;EACAC,OAAA;IACA,MAAAC,eAAA;MACA,UAAAjB,SAAA,CAAAkB,IAAA;QACA,KAAAd,KAAA;QACA;MACA;MAEA,KAAAA,KAAA;MACA,KAAAD,YAAA;MAEA;QACA,MAAAgB,QAAA,SAAAtB,GAAA,CAAAuB,WAAA;UACAC,IAAA,OAAArB,SAAA;UACAsB,OAAA,OAAArB;QACA;QAEAsB,OAAA,CAAAC,GAAA,YAAAL,QAAA,CAAApB,IAAA;;QAEA;QACA,IAAAoB,QAAA,CAAApB,IAAA,IAAAoB,QAAA,CAAApB,IAAA,CAAA0B,MAAA;UACA;UACA,IAAAN,QAAA,CAAApB,IAAA,CAAA2B,SAAA;YACA,KAAAxB,QAAA,MAAAyB,OAAA,CAAAC,GAAA,CAAAC,eAAA,IAAAV,QAAA,CAAApB,IAAA,CAAA2B,SAAA;UACA;UACA;UAAA,KACA,IAAAP,QAAA,CAAApB,IAAA,CAAA+B,UAAA;YACA;YACA,KAAA5B,QAAA,4BAAAiB,QAAA,CAAApB,IAAA,CAAA+B,UAAA;UACA;UACA;UAAA,KACA;YACA;YACA,MAAAC,SAAA,OAAAC,IAAA,GAAAC,OAAA;YACA,KAAA/B,QAAA,MAAAyB,OAAA,CAAAC,GAAA,CAAAC,eAAA,oBAAAE,SAAA;;YAEA;YACAR,OAAA,CAAAW,IAAA;UACA;QACA;UACA,UAAAC,KAAA,CAAAhB,QAAA,CAAApB,IAAA,EAAAqC,OAAA;QACA;MACA,SAAAC,GAAA;QACA,KAAAjC,KAAA,cAAAiC,GAAA,CAAAD,OAAA;QACAb,OAAA,CAAAnB,KAAA,cAAAiC,GAAA;MACA;QACA,KAAAlC,YAAA;MACA;IACA;IACAmC,cAAA;MACA,UAAApC,QAAA;MAEAqC,SAAA,CAAAC,SAAA,CAAAC,SAAA,MAAAvC,QAAA,EACAwC,IAAA;QACAC,KAAA;MACA,GACAC,KAAA,CAAAP,GAAA;QACAd,OAAA,CAAAnB,KAAA,YAAAiC,GAAA;QACAM,KAAA;MACA;IACA;EACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}